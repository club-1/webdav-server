<VirtualHost *:8080>
	Define path /home/nicolas/www/webdav-server
	ServerName webdav.club1.fr
	ServerAdmin n.peugnet@free.fr

	DocumentRoot ${path}

	Header always set Access-Control-Allow-Origin "*"
	Header always set Access-Control-Allow-Methods "POST, GET, PUT, DELETE, OPTIONS, PROPFIND, MOVE, COPY, MKCOL, LOCK, UNLOCK"
	Header always set Access-Control-Allow-Credentials "true"
	Header always set Access-Control-Allow-Headers "Authorization,DNT,User-Agent,Keep-Alive,Content-Type,Accept,Destination,Origin,Depth,X-Requested-Within"

	RewriteEngine On
	RewriteCond %{REQUEST_METHOD} OPTIONS
	RewriteRule ^/files(.*)$ $1 [R=200,L]

	<Location "/">
		AuthName "Compte CLUB1"
		AuthType Basic
		AuthBasicProvider ldap
		AuthLDAPUrl ldap://localhost/ou=People,dc=club1,dc=fr?uid
		Require valid-user

		SetHandler "proxy:unix:/run/php/php-fpm.%{env:AUTHENTICATE_UID}.sock|fcgi://localhost${path}/server.php"
	</Location>

	ErrorLog ${APACHE_LOG_DIR}/webdav_error.log
	CustomLog ${APACHE_LOG_DIR}/webdav_access.log combined

</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet
